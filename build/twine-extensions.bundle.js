!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SnowmanExtensions=t():e.SnowmanExtensions=t()}(this,()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(){return{startState:()=>({inScriptBlock:!1,inStyleBlock:!1,scriptNesting:0}),token(e,t){if(e.match(/^<%/))return t.inScriptBlock=!0,t.scriptNesting=1,"keyword";if(t.inScriptBlock)return e.match(/^<%/)?(t.scriptNesting++,"keyword"):e.match(/^%>/)?(t.scriptNesting--,0===t.scriptNesting&&(t.inScriptBlock=!1),"keyword"):e.match(/^\/\/.*$/)||e.match(/^\/\*[\s\S]*?\*\//)?"comment":e.match(/^(var|let|const|function|if|else|for|while|return|new|this|window|document)\b/)?"keyword":e.match(/^(true|false|null|undefined)\b/)?"atom":e.match(/^"([^"\\]|\\.)*"/)||e.match(/^'([^'\\]|\\.)*'/)||e.match(/^`([^`\\]|\\.)*`/)?"string":e.match(/^\d+(\.\d+)?/)?"number":(e.next(),"variable");if(e.match(/^<!--[\s\S]*?-->/))return"comment";if(e.match(/^\[\[[^\]]+?\]\]/))return"link";if(e.match(/^<\/?[a-zA-Z][^>]*>/))return"tag";if(e.match(/^<style[^>]*>/))return t.inStyleBlock=!0,"tag";if(t.inStyleBlock){if(e.match(/^<\/style>/))return t.inStyleBlock=!1,"tag";if(e.match(/^[a-zA-Z-]+(?=\s*:)/))return"property";if(e.match(/^[^;{}]+/))return"string"}return e.eatWhile(/[^<[%]/)||e.next(),"text"}}}e.r(t),e.d(t,{commands:()=>o,mode:()=>n,parsePassageText:()=>p,toolbar:()=>c});const o={...function(e){const t={};for(const n of Object.keys(e)){const{matcher:o,wrapper:a}=e[n];t[n]=e=>{const t=e.getSelections().map(e=>o.test(e)?e.replace(o,"$1"):a(e));e.replaceSelections(t,"around"),e.focus()}}return t}({boldText:{matcher:/^<strong>(.*)<\/strong>$/,wrapper:e=>`<strong>${e}</strong>`},italicText:{matcher:/^<em>(.*)<\/em>$/,wrapper:e=>`<em>${e}</em>`},underlineText:{matcher:/^<u>(.*)<\/u>$/,wrapper:e=>`<u>${e}</u>`},header1:{matcher:/^# (.*)$/,wrapper:e=>`# ${e}`},header2:{matcher:/^## (.*)$/,wrapper:e=>`## ${e}`},header3:{matcher:/^### (.*)$/,wrapper:e=>`### ${e}`},header4:{matcher:/^#### (.*)$/,wrapper:e=>`#### ${e}`},header5:{matcher:/^##### (.*)$/,wrapper:e=>`##### ${e}`}}),...function(e){const t={};for(const n of Object.keys(e))t[n]=t=>{t.replaceSelection(e[n]),t.focus()};return t}({insertJavaScriptBlock:"<%  %>",insertJavaScriptExpression:"<%= %>",insertStoryRender:"<% window.Story.render('passage-name') %>",insertStoryGoTo:"<% window.Story.goTo('passage-name') %>",insertStoryStart:"<% window.Story.start() %>",insertConditional:"<% if (condition) { %>\n\n<% } %>",insertConditionalElse:"<% if (condition) { %>\n\n<% } else { %>\n\n<% } %>",insertLoop:"<% for (let i = 0; i < array.length; i++) { %>\n\n<% } %>",insertVariableSet:"<% s.variableName = value %>",insertVariableGet:"<%= s.variableName %>",insertVariableIncrement:"<% s.variableName++ %>",insertPassageLink:"[[Link Text->Passage Name]]",insertConditionalLink:"<% if (condition) { %>[[Link Text->Passage Name]]<% } %>",insertDiv:'<div class="">\n\n</div>',insertSpan:'<span class=""></span>',insertParagraph:"<p></p>",insertStyleBlock:"<style>\n\n</style>",insertCSSClass:".class-name {\n  \n}",insertComment:"\x3c!-- Comment --\x3e",insertJSComment:"<% // Comment %>",insertRandomChoice:'<%= ["option1", "option2", "option3"][Math.floor(Math.random() * 3)] %>',insertCurrentDate:"<%= new Date().toLocaleDateString() %>",insertCurrentTime:"<%= new Date().toLocaleTimeString() %>",insertDelay:"<% Utilities.delay(() => { /* code */ }, 1000) %>",insertEither:'<%= Utilities.either("option1", "option2", "option3") %>',insertRandomInt:"<%= Utilities.randomInt(1, 10) %>",insertRandomFloat:"<%= Utilities.randomFloat(0, 1) %>"})},a='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16,18 22,12 16,6"></polyline><polyline points="8,6 2,12 8,18"></polyline></svg>',r='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2-2V8z"></path><polyline points="14,2 14,8 20,8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10,9 9,9 8,9"></polyline></svg>',i='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 12h12"></path><path d="M6 20V4"></path><path d="M18 20V4"></path></svg>',l='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>',s='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>',m='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>';function d(e,t){return`data:image/svg+xml;base64,${btoa(e.replaceAll("currentColor",t))}`}function c(e,{foregroundColor:t}){const n=e.getDoc().somethingSelected();return[{type:"menu",icon:d(r,t),label:"Style",items:[{type:"button",label:"Bold",command:"boldText",disabled:!n},{type:"button",label:"Italic",command:"italicText",disabled:!n},{type:"button",label:"Underline",command:"underlineText",disabled:!n},{type:"separator"},{type:"button",label:"Comment",command:"insertComment",disabled:n}]},{type:"menu",icon:d(i,t),label:"Headers",items:[{type:"button",label:"Header 1",command:"header1",disabled:!n},{type:"button",label:"Header 2",command:"header2",disabled:!n},{type:"button",label:"Header 3",command:"header3",disabled:!n},{type:"button",label:"Header 4",command:"header4",disabled:!n},{type:"button",label:"Header 5",command:"header5",disabled:!n}]},{type:"menu",icon:d(a,t),label:"Snowman Code",disabled:n,items:[{type:"button",label:"JavaScript Block",command:"insertJavaScriptBlock"},{type:"button",label:"JavaScript Expression",command:"insertJavaScriptExpression"},{type:"button",label:"JavaScript Comment",command:"insertJSComment"},{type:"separator"},{type:"button",label:"If Statement",command:"insertConditional"},{type:"button",label:"If/Else Statement",command:"insertConditionalElse"},{type:"button",label:"For Loop",command:"insertLoop"},{type:"separator"},{type:"button",label:"Style Block",command:"insertStyleBlock"},{type:"button",label:"CSS Class",command:"insertCSSClass"}]},{type:"menu",icon:d(s,t),label:"Variables",disabled:n,items:[{type:"button",label:"Set Variable",command:"insertVariableSet"},{type:"button",label:"Get Variable",command:"insertVariableGet"},{type:"button",label:"Increment Variable",command:"insertVariableIncrement"},{type:"separator"},{type:"button",label:"Random Choice",command:"insertRandomChoice"},{type:"button",label:"Current Date",command:"insertCurrentDate"},{type:"button",label:"Current Time",command:"insertCurrentTime"}]},{type:"menu",icon:d(l,t),label:"Story",disabled:n,items:[{type:"button",label:"Passage Link",command:"insertPassageLink"},{type:"button",label:"Conditional Link",command:"insertConditionalLink"},{type:"separator"},{type:"button",label:"Render Passage",command:"insertStoryRender"},{type:"button",label:"Go To Passage",command:"insertStoryGoTo"},{type:"button",label:"Start Story",command:"insertStoryStart"},{type:"separator"},{type:"button",label:"Div Element",command:"insertDiv"},{type:"button",label:"Span Element",command:"insertSpan"},{type:"button",label:"Paragraph",command:"insertParagraph"}]},{type:"menu",icon:d(m,t),label:"Utilities",disabled:n,items:[{type:"button",label:"Delay Function",command:"insertDelay"},{type:"button",label:"Random Choice (either)",command:"insertEither"},{type:"button",label:"Random Integer",command:"insertRandomInt"},{type:"button",label:"Random Float",command:"insertRandomFloat"}]}]}function p(e){const t=[/\[\[(?:[^\]]+->)?([^\]]+)\]\]/g,/window\.Story\.render\(\s*['"`]([^'"`]+)['"`]\s*\)/g,/window\.Story\.goTo\(\s*['"`]([^'"`]+)['"`]\s*\)/g,/Story\.render\(\s*['"`]([^'"`]+)['"`]\s*\)/g,/Story\.goTo\(\s*['"`]([^'"`]+)['"`]\s*\)/g,/\$\(\s*['"`]tw-passage\[name\s*=\s*['"`]([^'"`]+)['"`]\][^'"`]*['"`]\s*\)/g],n=[],o=new Set;for(const a of t){let t;for(a.lastIndex=0;t=a.exec(e);){const e=t[1];e&&!o.has(e)&&(o.add(e),n.push(e))}}return n}return t})());